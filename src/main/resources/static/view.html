<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>view</title>
    <link rel="stylesheet" href="css/view.css">

    <script src="js/echarts.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/vue-resource.min.js"></script>

</head>
<body>


<div id="app">
    222

    <div id="chart" class="mainChart">

    </div>

    <button>getData</button>
</div>
</body>


<script type="text/javascript">
    var vm=new Vue({
        el:"#app",
        data:{
            // 指定图表的配置项和数据
            option:{
                title: {
                    text: '实时行情'
                },
                tooltip: {},
                legend: {
                    data:['现价']
                },
                grid: [
                    {
                        left: '10%',
                        right: '8%',
                        height: '60%'
                    },
                    {
                        left: '10%',
                        right: '8%',
                        top: '70%',
                        height: '30%'
                    }
                ],

                xAxis: [
                {
                    data: []
                },
                {
                    gridIndex: 1,
                    data: []
                }
                ],
                yAxis: [
                    {
                        type: 'value',
                        min: 'dataMin'
                    },
                    {
                        gridIndex: 1,
                        type: 'value',
                        min: 'dataMin'
                    }

                ],
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'line'
                    }
                },
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 10,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        bottom: '90%',
                        start: 10,
                        end: 100,
                        handleIcon: 'M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                        handleSize: '105%'
                    }

                ],


                series: [{
                    name: '现价',
                    type: 'line',
                    data: []
                },{
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    name:'volume',
                    type:'bar',
                    data:[]
                }
                ]
            },
            myChart:null,
            chartData:[]
        },
        mounted:function () {
            // 基于准备好的dom，初始化echarts实例
            this.myChart = echarts.init(document.getElementById('chart'));
            // 使用刚指定的配置项和数据显示图表。
            this.myChart.setOption(this.option);


        },
        created:function(){
            this.getData()
            // setInterval(function () {
            //     vm.getData()
            // },30*1000)

        },
        methods:{
            getData:function () {
                this.$http.post(
                    '/homeController/getHistoryData',
                    {},
                ).then(function (res) {
                    this.chartData=res.body
                    this.refreshChart()
                },function(){

                })

            },
            refreshChart:function () {
                this.option.xAxis[0].data=[]
                this.option.xAxis[1].data=[]
                this.option.series[0].data=[]
                this.option.series[1].data=[]
                this.chartData.forEach(function (i) {
                    vm.option.xAxis[0].data.push(i.date)
                    vm.option.xAxis[1].data.push(i.date)
                    vm.option.series[0].data.push(i.price)
                    vm.option.series[1].data.push(i.volume)

                })
                //处理交易量
                // for(i=0;i<this.chartData.length;i++){
                //     if(i>0){
                //         console.log('!')
                //         vm.option.series[1].data.push(vm.chartData[i].volume-vm.chartData[i-1].volume)
                //     }else{
                //         vm.option.series[1].data.push(vm.chartData[i].volume)
                //
                //     }
                // }
                this.myChart.setOption(this.option)
            }
        }


    })
</script>
</html>